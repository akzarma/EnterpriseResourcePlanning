{% extends 'dashboard_faculty.html' %}
{% block title %}
    Exam-Schedule | ERP
{% endblock title %}



{% block content %}
    <table class="table">
        <thead>
        <tr>
            <th></th>
            <th>Sr no.</th>
            <th>Exam</th>
            <th>Schedule</th>
            <th>Subjects</th>
        </tr>
        </thead>
        <tbody>
        {% for each_exam in exams %}
            <tr>
                <td><input type="checkbox" name="exam" value="{{ each_exam.id }}"></td>
                <td>{{ forloop.counter }}</td>
                <td>{{ each_exam.exam.exam_name }}</td>
                <td>{{ each_exam.schedule_start_date }}</td>
                <td>
                    {% for each_subject in each_exam.examsubject_set.all %}
                        {{ each_subject.subject.short_form }}
                    {% endfor %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% for each_room in available_rooms %}
        <input type="checkbox" name="room" value="{{ each_room.room_number }}">
        <label>{{ each_room.room_number }}</label>
    {% endfor %}
    <br><br>
    <input class="btn btn-primary" type="button" value="Check Availability" name="possible"
           onclick="check_availability();">



    <script>
        function check_availability() {

            let all_rooms = document.getElementsByName('room');

            let all_exams = document.getElementsByName('exam');

            let all_exams_id = [];
            let all_room_number = [];

            for (let i = 0; i < all_exams.length; i++) {
                if (all_exams[i].checked) {
                    all_exams_id.push(all_exams[i].value)
                }
            }
            for (let i = 0; i < all_rooms.length; i++) {
                if (all_rooms[i].checked) {
                    all_room_number.push(all_rooms[i].value)
                }
            }

            $.ajax({
                type: "POST",
                url: '{% url 'exam:check_availability' %}',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'room': all_room_number,
                    'exam': all_exams_id
                },
                success: function (data) {

                }
            });
        }
    </script>

{% endblock content %}
