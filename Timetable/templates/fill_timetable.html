<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Timetable</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet"
          href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.min.css">
    <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


    <style>
        html, body {
            background: #fff;
            font-family: 'Roboto', sans-serif;
        }

        legend {
            color: #0379C4;
        }

        .navbar {
            box-shadow: 0 0 40px 0 rgba(0, 0, 0, 0.1);
            background: white;
            font-family: 'Roboto', sans-serif;
            border: 0;
            padding: 10px;
        }

        .navbar-brand {
            color: #0379C4 !important;
            font-weight: bolder;
        }

        .navbar-default .navbar-nav > .active > a, .navbar-default .navbar-nav > .active > a:hover {
            background: white;
        }

        .navbar-default .navbar-nav > li {
            font-weight: bold;
        }

        .navbar-default .navbar-nav > li:hover {
            box-shadow: 0 0 40px 0 rgba(0, 0, 0, 0.1);

        }

        .navbar-toggle {
            border: none;
        }

        .navbar-toggle:active, .navbar-toggle:hover, .navbar-toggle:focus {

            background: white !important;

        }

        .form-element {
            margin: 15px 0;
        }

        .col-lg-6 {
            height: 100%;
        }

        .row {
            padding: 10px;
        }

        #myImg {
            width: 140px;
        }

        #input-file {
            padding-bottom: 15px;
        }

        #id_doc_profile_pic {
            display: none;
        }

        #id_projects {
            width: 170px;
            height: 190px;
        }

        .error {
            color: #d9534f !important;
        }

        .my-border-1 {
            border: 1px black solid;
            padding: 0;
        }

        .top-border {
            border-top: 1px black solid;
        }

        .content .row {
            border-top: 1px black solid;
            border-top: 1px black solid;

        }

        .vertical-div {
            height: 40px;
            width: 1px;
            background: red;
            display: inline-block;
        }

        .vertical-divider {
            clear: both;
            position: relative;
        }

        .vertical-divider:after {
            clear: both;
            content: " ";
            display: block;
            height: 0;
            visibility: hidden;
        }

        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 10px;
            text-align: center;
        }

        .block div {
            color: black;
            width: 50%;
            height: 50%;
            float: left;
            padding: 0;
        }

        #div1 {
            background: #DDD;
        }

        #div2 {
            background: #AAA;
        }

        #div3 {
            width : 100%;
            background: #777;
        }

        #div4 {
            background: #444;
        }
    </style>
    <script>

    </script>
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#"><i class="glyphicon glyphicon-flash"></i>ERP</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">About</a></li>
                <li><a href="#">Support</a></li>
            </ul>
        </div>
    </div>
</nav>
<div>
    <h4>
        Branch:{{ branch }}
    </h4>

</div>

<form method="post" action="{% url 'Timetable:fill_timetable' %}" enctype="multipart/form-data">
    {% csrf_token %}
    <label for="id_year">Year: </label>
    <select id="id_year" onchange="loadSubjects()">
        {% for yr in year %}
            <option>{{ yr }}</option>
        {% endfor %}
    </select>
    <label for="id_subject">Subjects: </label>
    <select id="id_subject">
        {% for subject in subjects %}
            <option>{{ subject }}</option>
        {% endfor %}
    </select>
    <br>
    <div class="container">
        <table style="width:100%;">
            <tr>
                <th colspan="2">Time</th>
                {% for day in days %}
                    <th>
                        {{ day }}
                    </th>
                {% endfor %}
            </tr>
            {% for time in times %}
                <tr>
                    <th rowspan="4">
                        {{ time }}
                    </th>

                    {% for x in division %}
                        <tr>
                            {% for z in '1234567' %}

                                {% if forloop.counter0 %}
                                    <td class="block">
                                        <input type="checkbox" name="id_faculty_{{ time }}_{{ x }}_{{ z }}" value="Bike"
                                               onchange="getFaculty(this)">
                                        Select
                                        <div id="id_faculty_{{ time }}_{{ x }}_{{ z }}">Faculty
                                        </div>
                                        <div id="id_faculty_{{ time }}_{{ x }}_{{ z }}_room" style="background: #ABABAB;width: 100%">Room
                                        </div>
                                    </td>
                                {% else %}
                                    <td>{{ x }}</td>
                                {% endif %}
                            {% endfor %}

                        </tr>
                    {% endfor %}

            {% endfor %}
        </table>
    <br />
    <div class="col-md-offset-6">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
    </div>
</form>
<br>
<br>
<br>
<br>


</body>
<script>

    function loadSubjects() {
        var subject = document.getElementById('id_subject');
        var year = document.getElementById('id_year');
        $.ajax({
            type: "POST",
            url: '{% url 'Timetable:get_subject' %}',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'year': year.value
            },
            success: function (data) {
                data = data.split(',');
                var len = subject.options.length;
                for (var j = 0; j < len; j++) {
                    subject.options.remove(0);
                }
                for (var i = 0; i < data.length; i++) {
                    var option = document.createElement('option');
                    option.text = data[i];
                    option.value = data[i];
                    subject.append(option);
                }
            }
        })

    }

    function getFaculty(object) {
        if (object.checked) {
            var subject = document.getElementById('id_subject');
            var division = object.name.split('_')[3];
            var year = document.getElementById('id_year');
            {#        alert(object.name.split('_'));#}
            $.ajax({
                type: "POST",
                url: '{% url 'Timetable:get_faculty' %}',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'subject': subject.value,
                    'division': division,
                    'year': year.value,
        },
            success: function (data) {
                {#                alert(data);#}
                {#                alert(data);#}
                {#                alert(data);#}
                {#                    alert(data);#}
                var parsed = JSON.parse(data);
                faculty = parsed.faculty;
                {#                    alert(faculty);#}
                faculty += ',';
                faculty = faculty.split(',');
                var div_to_add = document.getElementById(object.name);
                while (div_to_add.hasChildNodes()) {
                    div_to_add.removeChild(div_to_add.firstChild);
                }
                {#                alert(object.name);#}
                var newOption = document.createElement('select');
                var option;
                for (i = 0; i < faculty.length - 1; i++) {
                    option = document.createElement('option');
                    option.text = faculty[i];
                    option.value = faculty[i];
                    newOption.add(option);
                }
                div_to_add.appendChild(newOption);
                var toDisable = parsed.divisions;
                {#                    alert(toDisable);#}
                if (toDisable) {
                    {#                        alert(object.name);#}
                    for (div in toDisable) {
                        var namesArray = object.name.split('_');
                        {#                        alert(namesArray);#}
                        var fullName = namesArray[0] + '_' + namesArray[1] + '_' + namesArray[2] + '_' + toDisable[div] + '_' + namesArray[4];
                        document.getElementsByName(fullName)[0].disabled = true;
                        {#                            alert(fullName);#}
                    }

                }

            }
        })
        }
        else {
            var div_to_remove = document.getElementById(object.name);
            while (div_to_remove.hasChildNodes()) {
                div_to_remove.removeChild(div_to_remove.firstChild);
            }
            var text = document.createElement('p');
            text.value = "Faculty";
            div_to_remove.appendChild(text);
            {#            alert('{{ divisions_js }}');#}
            var namesArray = object.name.split("_");
            var allDivisions = '{{divisions_js}}';
            {#            alert(allDivisions);#}
            for (var i in allDivisions) {
                var fullName = namesArray[0] + '_' + namesArray[1] + '_' + namesArray[2] + '_' + allDivisions[i] + '_' + namesArray[4];
                {#                alert(fullName);#}
                document.getElementsByName(fullName)[0].disabled = false;
            }
        }

    }
</script>
</html>