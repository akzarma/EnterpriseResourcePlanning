{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <link rel="stylesheet" href="/templates/loading.css">

    {#    <meta http-equiv="X-UA-Compatible " content="IE=edge">#}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {{ form.non_field_label_tag }}

    <link href="https://fonts.googleapis.com/css?family=Merriweather:900" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet"
          href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.min.css">
    <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <meta charset="utf-8">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.css" rel="stylesheet"
          type="text/css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
    {#    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">#}
    {#    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">#}
    {##}
    <link rel="stylesheet" href="/templates/loading.css">
    {##}
    <meta http-equiv="X-UA-Compatible " content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}ERP{% endblock %}</title>
    {#    {{ form.non_field_label_tag }}#}
    <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.js"></script>
    {##}
    <link href="https://fonts.googleapis.com/css?family=Merriweather:900" rel="stylesheet">
    {#    <link href="http://cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/build/css/bootstrap-datetimepicker.css"#}
    {#          rel="stylesheet">#}
    {##}
    {##}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet"
          href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.min.css">
    <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.17/jquery.datetimepicker.full.min.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.17/jquery.datetimepicker.css">

    <!---Context Menu Libraries -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.6.4/jquery.contextMenu.min.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.6.4/jquery.contextMenu.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.6.4/jquery.ui.position.min.js"></script>


    {#    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>#}
    {#    <script>#}
{#    <script>#}
{#        $('.datepicker').datepicker();#}
{#    </script>#}
    {##}
    {##}
    {#    <link rel="stylesheet" type="text/css" media="screen"#}
    {#          href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">#}
    {#    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">#}
    {#    <link href="./css/prettify-1.0.css" rel="stylesheet">#}
    {#    <link href="./css/base.css" rel="stylesheet">#}
    {#    <link href="http://cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/build/css/bootstrap-datetimepicker.css"#}
    {#          rel="stylesheet">#}
    {##}
    {##}
    {#    <script async="" src="http://www.google-analytics.com/analytics.js"></script>#}
    {#    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>#}
    {#    <script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>#}
    {#    <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.js"></script>#}
    {#    <script src="http://cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/src/js/bootstrap-datetimepicker.js"></script>#}


    <style>
        html, body {
            background: #fff;
            font-family: 'Roboto', sans-serif;
        }

        legend {
            color: #0379C4;
        }

        .navbar {
            box-shadow: 0 0 40px 0 rgba(0, 0, 0, 0.1);
            background: white;
            font-family: 'Roboto', sans-serif;
            border-radius: 0;
            padding: 6px;
        }

        .navbar-brand {
            color: #0379C4 !important;
            font-weight: bolder;
        }

        .navbar-default .navbar-nav > .active > a {

        }

        .navbar-default .navbar-nav > li {
            font-weight: bold;
        }

        .navbar-default .navbar-nav > li:hover {
            background-color: #cccccc;
        }

        .navbar-toggle {
            border: none;
        }

        .navbar-toggle:active, .navbar-toggle:hover, .navbar-toggle:focus {
            background: white !important;

        }

        .form-element {
            margin: 15px 0;
        }

        .col-lg-6 {
            height: 100%;
        }

        .row {
            padding: 10px;
        }

        #myImg {
            width: 140px;
        }

        #input-file {
            padding-bottom: 15px;
        }

        #id_doc_profile_pic {
            display: none;
        }

        .input-file {
            padding-bottom: 15px;
        }

        .error {
            color: #d9534f !important;
        }

        .navbar-nav > li > a {
            height: 100%;
        }

        p {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            font-weight: 300;
            line-height: 1.7em;
            color: #999;
        }

        /*
        Notification style

        */
        .badge-notify {
            font-size: 10px;
            background: red;
            position: absolute;
            top: 5px;
            left: 25px;
            border-radius: 50%;
        }

        /* The Overlay (background) */
        .overlay {
            /* Height & width depends on how you want to reveal the overlay (see JS below) */
            display: none;
            height: 100%;
            width: 100%;
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            background-color: rgb(0, 0, 0); /* Black fallback color */
            background-color: rgba(0, 0, 0, 0.9); /* Black w/opacity */
            overflow-x: hidden; /* Disable horizontal scroll */
            transition: 0.5s; /* 0.5 second transition effect to slide in or slide down the overlay (height or width, depending on reveal) */
        }

        /* Position the content inside the overlay */
        .overlay-content {
            position: relative;
            top: 25%; /* 25% from the top */
            width: 100%; /* 100% width */
            text-align: center; /* Centered text/links */
            margin-top: 30px; /* 30px top margin to avoid conflict with the close button on smaller screens */
        }

        /* The navigation links inside the overlay */
        .overlay a {
            padding: 8px;
            text-decoration: none;
            font-size: 36px;
            color: #FFFFFF;
            display: block; /* Display block instead of inline */
            transition: 0.3s; /* Transition effects on hover (color) */
        }

        /* Position the close button (top right corner) */
        .overlay .closebtn {
            position: absolute;
            top: 20px;
            right: 45px;
            font-size: 60px;
        }


    </style>
    {% block style %}

    {% endblock style %}
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><i class="glyphicon glyphicon-flash"></i>ERP</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="#">About</a></li>
                <li><a href="#">Support</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="bell-icon dropdown">
                    <button class="btn btn-default btn-lg btn-link dropdown-toggle"
                            style="font-size:20px;display: inline;" data-toggle="dropdown" role="button"
                            aria-haspopup="true"
                            aria-expanded="false">
                        <span class="glyphicon glyphicon-bell"></span>
                    </button>
                    <span class="badge badge-notify dropdown-toggle" id="notification_count" data-toggle="dropdown"
                          role="button"
                          aria-haspopup="true"
                          aria-expanded="false"></span>
                    <ul class="dropdown-menu" id="notification_dropdown"></ul>
                </li>
                <li class="dropdown">
                    {% block navbar-right %}
                        {% if user.is_authenticated %}


                            {% if user.student %}

                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                   aria-haspopup="true"
                                   aria-expanded="false">


                                    Welcome <span
                                        style="color: #0379C4; text-transform: uppercase;">{{ user.student.first_name }}</span><span
                                        class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li>&nbsp;&nbsp;<span class="glyphicon glyphicon-info-sign"></span>
                                        <p style="display: inline">GR number: {{ user.student.gr_number }}</p></li>
                                    <li role="separator" class="divider"></li>
                                    {#                                    <li><a href="{% url 'registration:change_password' %}"><span class="glyphicon glyphicon-lock"></span> Change Password</a></li>#}
                                    <li><a href="{% url 'dashboard:profile' %}"><span
                                            class="glyphicon glyphicon-user"></span>View Profile</a></li>
                                    <li><a href="{% url 'dashboard:logout' %}"><span
                                            class="glyphicon glyphicon-off"></span> Logout</a>
                                    </li>
                                </ul>
                            {% else %}

                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                   aria-haspopup="true"
                                   aria-expanded="false">Welcome <span
                                        style="color: #0379C4; text-transform: uppercase;">{{ user.faculty.first_name }}</span><span
                                        class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li>&nbsp;&nbsp;<span class="glyphicon glyphicon-info-sign"></span>
                                        <p style="display: inline">Faculty Code: {{ user.faculty.faculty_code }}</p>
                                    </li>
                                    <li role="separator" class="divider"></li>
                                    <li><a href="{% url 'dashboard:profile' %}">View Profile</a></li>
                                    <li><a href="{% url 'dashboard:logout' %}"><span
                                            class="glyphicon glyphicon-off"></span>Logout</a>
                                    </li>
                                </ul>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'login:login' %}" class="dropdown-toggle" role="button">Sign In</a>
                        {% endif %}
                    {% endblock navbar-right %}
                </li>

            </ul>
        </div>
    </div>
</nav>
{% if error %}
    <div class="alert alert-danger">
        <strong>Error!</strong>
        {% autoescape off %}{{ error }} {% endautoescape %}
    </div>
{% endif %}
{% if info %}
    <div class="alert alert-info">
        {% autoescape off %}{{ info }} {% endautoescape %}
    </div>
{% endif %}
{% if success %}
    <div class="alert alert-success">
        {% autoescape off %}{{ success }} {% endautoescape %}
    </div>
{% endif %}


<!-- The overlay -->
<div id="notification_overlay" class="overlay">

    <!-- Button to close the overlay navigation -->
    <a href="javascript:void(0)" class="closebtn" onclick="overlay_off()">&times;</a>

    <!-- Overlay content -->
    <div class="overlay-content" id="notification_overlay_text"></div>

</div>

{% block body %}
{% endblock body %}

</body>

{% block html %}
{% endblock html %}

<script>
    var current_date;
    var notifications_json;
    $(document).ready(function () {
        //Gets notification
        $.ajax({

            url: '{% url 'dashboard:get_notifications' %}',
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function (data) {
                console.log(data);
                notifications_json = JSON.parse(data);
                console.log(notifications_json);
                current_date = new Date(notifications_json['today']);

                var notification_list = document.getElementById('notification_dropdown');

                let notification_num_obj = document.getElementById('notification_count');

                let num_of_notifications = 0;
                for (each in notifications_json) {
                    if (each !== 'today') {
                        num_of_notifications++;

                        let li = document.createElement('li');
                        let a = document.createElement('a');
                        let temp_json = JSON.parse(notifications_json[each]);

                        let heading = document.createElement('h4');
                        heading.innerHTML = temp_json.fields.heading;
                        a.appendChild(heading);
                        let para = document.createElement('p');
                        para.innerHTML = temp_json.fields.notification.substr(0, 100) + '...';
                        a.appendChild(para);
                        a.setAttribute("value", each);
                        a.setAttribute("onclick", "showExpandedNotification('" + each + "')");
                        li.appendChild(a);
                        notification_list.appendChild(li);
                    }

                }
                let li = document.createElement('li');
                let a = document.createElement('a');
                a.style.textAlign = "center";
                a.innerHTML = "Show all notifications";
                a.href = '{% url 'dashboard:show_all_notifications' %}';
                li.appendChild(a);
                notification_list.appendChild(li);

                notification_num_obj.innerHTML = num_of_notifications;

            }

        });

        {% block on_ready %}
        {% endblock on_ready %}
    });

    function showExpandedNotification(index) {
        let text = document.getElementById('notification_overlay_text');
        while (text.firstChild) {
            text.removeChild(text.firstChild);
        }

        let temp_json = JSON.parse(notifications_json[index]);

        let heading = document.createElement('h2');
        heading.innerHTML = temp_json.fields.heading;
        text.appendChild(heading);

        let para = document.createElement('h4');
        para.innerHTML = temp_json.fields.notification;
        text.appendChild(para);


        document.getElementById("notification_overlay").style.display = "block";
    }

    function overlay_off() {
        document.getElementById("notification_overlay").style.display = "none";

    }

</script>

</html>